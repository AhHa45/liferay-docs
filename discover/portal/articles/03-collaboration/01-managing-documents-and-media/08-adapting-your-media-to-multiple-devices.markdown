# Adapting Your Media across Multiple Devices [](id=adapting-your-media-across-multiple-devices)

People consume content across multiple devices. One person may be browsing the 
web on their phone, or in a coffee shop checking their favorite blogs on their 
tablet, or at home viewing family photos on their laptop, desktop, game system, 
streaming device, or something else. All these devices have different screen 
sizes, bandwidths, processing capabilities, etc. that must be considered when 
delivering media content. @product@'s Adaptive Media app is the solution. 

Adaptive Media is an Application for Liferay Portal CE 7.0 and Liferay DXP, 
available for download from the [Liferay Marketplace](https://web.liferay.com/marketplace),  
that delivers your media content in the best format, based on the channel 
and device that consumes it. 

This provides faster loading times for devices with a slower connection, saving 
bandwidth, and also gives administrative control over the image quality provided. 

## How It Works [](id=how-it-works)

Portal Administrators define a set of image resolutions to deliver to the user's 
device. New copies of the image are generated by Adaptive Media that are scaled 
to fit the desired resolutions, while maintaining their original aspect ratio. 

Adaptive Media is integrated with Documents and Media, Blogs, and Web Content. 

Images uploaded to Documents and Media or to a Blog Entry are analyzed and 
processed, generating a set of images with the defined resolutions. For 
instance, when a user is reading a blog entry on their mobile phone that 
contains an image, Adaptive Media checks the screen size of the phone and 
delivers the copy of the image that best fits the screen. 

Adaptive Media also ensures that your high resolution devices receive a high 
resolution image for the optimal viewing experience. 

## Adding Image Resolutions [](id=adding-image-resolutions)

Portal Administrators can manage Adaptive Media by opening the Control Panel and 
selecting *Adaptive Media* under the *Configuration* heading. 

![Figure 1: Add a new image resolution under the Adaptive Media Configuration. ](../../../images/adaptive-media-configuration.png)

Portal administrators must specify the image resolutions to generate when a new 
image is uploaded. New resolutions are automatically generated for all images 
uploaded after the resolution is created. Existing images are not updated. To 
apply a new resolution to previously uploaded images, you must trigger the 
process to adapt the remaining images. This process is covered in the 
[Generating Missing Image Resolutions section](#generating-missing-image-resolutions). 

+$$$

**Note:** Adaptive Media configurations are scoped per virtual instance and 
apply to that instance only. 

$$$

To add a new resolution, click the plus button on the bottom right corner of the 
application. Fill in the following fields for the new image resolution:

**Title**: A name used for identification purposes (must be unique. No two image 
resolutions can share the same title.)

**Maximum Width**: The maximum width of the generated image. If a 
*Maximum Height* is given, this field is optional. This value must be at least 1.

**Maximum Height**: the maximum height of the generated image. If a 
*Maximum Width* is given, this field is optional. This value must be at least 1.

By default, the image resolution's *identifier* is automatically generated based 
on the image resolution's *Title*. You can specify a custom identifier by 
clicking the radio button next to *Custom* under the *Identifier* heading, and 
entering a new ID. The identifier can be used by third party applications to 
obtain the images for that particular resolution, via the Adaptive Media APIs.

![Figure 2: Specify an Identifier for an image resolution to make it available in the APIs.](../../../images/adaptive-media-new-img-resolution.png)

You can also create a resolution for high density displays. If the administrator 
selects this option, a new resolution for these devices is created with the 
same title and the suffix *-2x*. This option is only available when adding new 
image resolutions. These resolutions have a width and height that is double the 
original. For example, if the original resolution has a *Maximum Width* of 400px 
and a *Maximum Height* of 300px, the high density resolution will have a 
*Maximum Width* of 800px and a *Maximum Height* of 600px. 

### How many image resolutions should I add? [](id=how-many-image-resolutions-should-i-add)

The number of image resolutions and the values for each resolution depends on 
the use case. The more image resolutions added, the more optimal the image 
delivery is, but this also requires more storage and computational resources to 
generate these images.

To start, It’s recommended that you create resolutions to cover the common 
device sizes, such as mobile phones, tablets, laptops, desktops, etc, and name 
them with the device they target. 

If a majority of users are using a particular device 
(all the users of the intranet have the same company mobile phone for example), 
you can create a resolution to target that device. 

## Updating Image Resolutions [](id=updating-image-resolutions)

Portal administrators can modify the title of an existing image resolution if a 
custom identifier is defined. **The image resolution and identifier can’t be 
updated if the resolution has been used to create Adaptive Media images**. This 
prevents inconsistencies in the images. Otherwise, if changes were made to the 
resolutions, the images generated before this change would have a completely 
different size than the images created after this change. 

If you need to change the values of an image resolution, you can delete the 
image resolution and create a new one with the appropriate values. See the 
[Deleting Image Resolutions](#deleting-image-resolutions) section for more 
information.

## Disabling, Enabling, and Deleting Image Resolutions [](id=disabling-enabling-and-deleting-image-resolutions)

Although Adaptive Media automatically generates images for resolutions when a 
new image is uploaded, this behavior can be disabled if you wish. 

### Disabling Image Resolutions [](id=disabling-image-resolutions)

To disable an image resolution, open the Actions menu next to the image 
resolution and select *Disable*. Any images uploaded after the resolution is 
disabled use the most appropriate image resolution that is still active. Images 
previously generated with the disabled image resolution are still available.

### Enabling Image Resolutions [](id=enabling-image-resolutions)

To enable a disabled image resolution, open the Actions menu next to the image 
resolution and select *Enable*. Note that while an image resolution is disabled 
it doesn’t generate images for new uploads. After enabling an image resolution, 
it’s recommended to generate the images that may have been missed. To generate 
any missing images for an enabled resolution, follow the instructions in the 
[Generating Missing Image Resolutions](#generating-missing-image-resolutions) 
section.

### Deleting Image Resolutions [](id=deleting-image-resolutions)

Portal Administrators can also delete image resolutions. 
**Proceed with caution.** When an image resolution is deleted, the existing 
images generated for that resolution are deleted as well and can no longer be 
used or referenced in any content. **This operation can't be undone**. 

**To delete a resolution, it must be disabled first.** This acts as a safety 
guard to ensure that image resolutions are not accidentally deleted. Once the 
resolution is disabled, select *Delete* from the Actions menu to delete the 
resolution and all images that have been generated for the resolution. 

## Generating Missing Image Resolutions [](id=generating-missing-image-resolutions)

There may be cases where an image resolution hasn't generated all the images 
that you require. For example, if you disable an image resolution and upload new 
images, or perhaps you add a new image resolution that hasn't been applied to 
existing images. In these scenarios the adapted images for an image resolution 
isn't 100%. 

<!-- Include screenshot of less than 100% adapted images -->

Portal Administrators can trigger the process to adapt the missing images. Each 
image resolution can be adapted individually by selecting the 
*Optimize Remaining* option from the Actions menu next to the resolution. 
Alternatively You can adapt all image resolutions at once by selecting the 
*Optimize All Images* option from the Actions menu in the Control Menu at the 
top of the page. 

## Creating Content with Adaptive Media Images [](id=creating-content-with-adaptive-media-images)

Adaptive Media works in Blog entries and Web Content Articles directly out of 
the box. Just add your image(s) to your content using the Image Selector and 
Adaptive Media prepares your images behind the scenes.

Adaptive Media delivers the latest available image resolutions in your content 
(even if the image resolution is added after the images are uploaded). This is 
possible because each image resolution's link isn't saved in the content. 
Instead, each image is identified with an HTML `data-fileentryid` attribute that 
is replaced with the latest image resolution when the user views the content.

+$$$

**Note:** If Adaptive Media is uninstalled, the original images are displayed in 
the blog entries and web content articles as a fallback mechanism.

$$$

### Using the Image Selector

You can add images in blog entries, and web content articles by clicking the 
image button from the editor and then selecting the image in the image selector. 
Note that **Adaptive Media only works for blog entries with images added from 
the *Blog Images*, *Documents and Media*, and *Upload* tabs**. Likewise, 
**Adaptive Media only works for web content articles with images added from the 
*Documents and Media* tab**. Note that the *URL* tab doesn't work for Adaptive 
Media for either content because the image is linked directly from the URL, and 
therefore provides no image file for Adaptive Media to copy.

You can also use Adaptive Media images in Advanced Web Content. Just be sure to 
include an image field in the web content Structure. Then you can add the image 
field to the matching template, by selecting it on the left side of the editor. 
If you select it, the following snippet is included in the template:

    <#if Imagecrrf.getData()?? && Imagecrrf.getData() !="">
        <img alt="${Imagecrrf.getAttribute("alt")}" src="${Imagecrrf.getData()}" />
    </#if>
    
This snippet includes the `data-fileentryid` attribute to ensure that the image 
is dynamically replaced by Adaptive Media with the available image resolutions.

The image is included in the blog entry's content or web content article, and if 
you inspect the HTML in the code view of the editor you should see something 
like this:

    <img data-fileentryid="37308" 
    src="/documents/20143/0/photo.jpeg/85140258-1c9d-89b8-4e45-d79d5e262318?t=1518425" />

Note that there is an `<img>` tag with a `data-fileentryid` attribute. Adaptive 
Media uses the identifier of the attribute to automatically replace the `<img>` 
element with a `<picture>` element that contains all the available Adaptive 
Media images and the optimal device for each of them.

While editing a blog entry or web content article, the HTML of the content uses 
the format described before: an `<img>` tag with a `data-fileentryid` attribute. 
When the blog entry or web content article is displayed in the Blogs application, 
or in the Asset Publisher application, the HTML is automatically replaced and 
looks similar to this:

    <picture>

        <source media="(max-width:850px)" 
        srcset="/o/adaptive-media/image/44147/med/photo.jpeg">

        <source media="(max-width:1200px) and (min-width:850px)" 
        srcset="/o/adaptive-media/image/44147/hd/photo.jpeg">

        <source media="(max-width:2000px) and (min-width:1200px)" 
        srcset="/o/adaptive-media/image/44147/ultra-hd/photo.jpeg">

        <img src="/documents/20140/0/photo.jpeg/1992-9143-85d2-f72ec1ff77a0">

    </picture>

The example above uses three different images with three different resolutions. 
Additionally, the original image is used as a fallback in case the adaptive 
media images are not available.
 
### Dragging and Dropping an Image

Users can also include an image in a blog entry by dragging and dropping the 
image into the content. These images are automatically uploaded to the Blog 
images repository when the blog entry is published.

+$$$

**Note:** Adaptive Media isn't supported for drag and drop in web content 
articles.

$$$

The respective Adaptive Media image versions are automatically created for each 
of the blog images uploaded, and they are automatically used in the entry's 
content. You can see this by inspecting the HTML and checking that the `<img>` 
tag and the `data-fileentryid` attribute are added to the image.

**Important:** Adaptive Media is only applied to the blog entry's content. 
Currently Adaptive Media does not apply to the cover image of the blog entry.

### Using the Source View of the editor
<!-- Does this require you to know how to use the APIs to get the file entry ID? -->
You can also add Adaptive Media images to a blog entry or web content article by 
manually writing the HTML code in the source view of the editor. To do this you 
have to include an `<img>` tag with a `data-fileentryid` attribute containing 
the image's file entry ID. An example snippet is shown below:

    <img data-fileentryid="37308" 
    src="/documents/20143/0/photo.jpeg/85140258-1c9d-89b8-4e45-d79d5e262318?t=1518425" />

Adaptive Media automatically replaces the `<img>` tag and obtains the 
information from the file entry identifier when the blog entry or web content 
article is displayed.

## Using Staging with Adaptive Media

Adaptive Media is fully integrated with Staging and Export/Import functionality 
in @product@.

When a blog entry or a web content article is published from staging, Adaptive 
Media scans the content for adaptive media images and publishes them to the live 
environment. The content is updated to match the new published adaptive media 
images in the live environment.

When blog entries or web content articles are exported, Adaptive Media images 
are exported in the LAR file as well. When a LAR file is imported that includes 
Adaptive Media images, the blog entry or web content article is updated to use 
the new imported adaptive media images.

Adaptive media images are not regenerated during the export/import process or 
staging publication process. Instead, Adaptive Media reuses the existing images 
to improve the process's performance.

## Image Versioning with Adaptive Media

Users can modify existing images in Documents and Media by uploading a new 
image. They can also edit existing images using the Image Editor. In both cases 
a version history with all the changes is preserved in Documents and Media.

There are two different kinds of URLs that are supported for Adaptive Media 
Images, depending on whether the URL points to a specific version of the image, 
or whether it points to the latest version.

An example pattern of each type of URL is shown below:

Latest version:

    /o/adaptive-media/image/[file-entry-id]/[image-resolution-id]/[image title]
    
This relative URL points to the latest version of the adaptive media image 
generated with the file entry ID *34798* and image resolution ID *thumbnail*:

    /o/adaptive-media/image/34798/thumbnail/beach.jpeg


Specific version:

    /o/adaptive-media/image/[file-entry-id]/[file-version-id]/[image-resolution-id]/[image title]

This URL points to the adaptive media image generated with the file entry ID 
*34798*, file version ID *34803*, and image resolution ID *thumbnail*:

    /o/adaptive-media/image/34798/34803/thumbnail/beach.jpeg

## How the Recycle Bin Handles Adaptive Media

Adaptive Media images are not displayed in the Recycle Bin because they can't be 
moved there explicitly. Instead, images in Documents and Media can be moved to 
the Recycle Bin. If the original image is in the Recycle Bin, the corresponding 
Adaptive Media images behave as if they are in the Recycle Bin. While they 
remain in the Recycle Bin, the original image and Adaptive Media images can't be 
viewed by users.

+$$$

**Note:** Adaptive Media URLs that point to Adaptive Media images whose original 
image is in the Recycle Bin return an error code of *404 Not Found*.

$$$

When the original image is restored from the Recycle Bin, the Adaptive Media 
images are available and accessible again.

## Advanced Configuration

Adaptive Media can be configured by Portal Administrators via System Settings in 
the Control Panel, under the *Collaboration* tab. There are two configurations 
for Adaptive Media: *Adaptive Media* and *Adaptive Media Image*.

### Adaptive Media

This configuration affects every virtual instance and is related to the 
asynchronous processing done by Adaptive Media. These values can be modified to 
improve performance for specific scenarios or use cases.

The following configuration options are available:

**Workers max size:** The maximum size of workers that can process adaptive 
media. The default value is 10 workers.

**Workers core size:** The size of core workers that can process adaptive media. 
This size should always be smaller or equal to *Workers Max Size*. This size can 
be modified to improve performance for specific environments and use cases. The 
default value is 5 workers.

### Adaptive Media Image

This configuration can be different for each virtual instance. This only 
contains the option below:

**MimeTypes:** A list of the image mime types that are supported by Adaptive 
Media. If an image is uploaded and the MIME type is not contained in this list, 
Adaptive Media ignores it and doesn't process it.